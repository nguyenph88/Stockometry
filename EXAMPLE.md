# Stockometry - JSON Output Guide (v3)

This document explains the structure and meaning of the daily JSON report generated by Stockometry. This enhanced version includes comprehensive sector coverage (11 sectors), executive summary, source article links, and enhanced signal analysis for full transparency and auditability.

---

## Top-Level Structure

Each JSON file represents a single day's analysis and contains the following top-level fields:

| Field               | Type   | Description                                                                                             | Example Value                  |
| ------------------- | ------ | ------------------------------------------------------------------------------------------------------- | ------------------------------ |
| `report_id`         | Integer| The unique ID of the report from the database.                                                          | `42`                           |
| `report_date`       | String | The date (UTC) for which the analysis was performed, in `YYYY-MM-DD` format.                              | `"2025-08-21"`                 |
| `generated_at_utc`  | String | The precise timestamp (UTC) when the report was generated, in ISO 8601 format.                            | `"2025-08-21T02:30:00.123456"`  |
| `executive_summary` | String | A human-readable summary of the day's key findings and signals.                                          | `"A consistent bullish trend was observed..."` |
| `run_source`        | String | **New!** Indicates whether the report was generated from "ONDEMAND" or "SCHEDULED" run.                  | `"ONDEMAND"` or `"SCHEDULED"`   |
| `signals`           | Object | The core of the report, containing all the analytical signals. See detailed breakdown below.              | `{...}`                        |

---

## Supported Market Sectors

Stockometry now analyzes **11 comprehensive market sectors** for complete market coverage:

### 🚀 **Technology**
- **Companies**: AAPL, MSFT, GOOGL, NVDA, TSLA, META, NFLX, ADBE, CRM, ORCL, INTC, AMD
- **Focus**: Software, hardware, AI, semiconductors, social media, streaming

### 🛒 **Consumer Discretionary**
- **Companies**: AMZN, TSLA, HD, MCD, NKE, SBUX, DIS, CMCSA
- **Focus**: Retail, automotive, restaurants, entertainment, media

### 🏦 **Financial Services**
- **Companies**: JPM, GS, BAC, WFC, C, MS, BLK, AXP, V, MA, BRK.A, BRK.B
- **Focus**: Banking, investment, insurance, payment processing, asset management

### 🏥 **Healthcare**
- **Companies**: JNJ, UNH, PFE, ABBV, TMO, ABT, LLY, DHR, BMY, AMGN, GILD
- **Focus**: Pharmaceuticals, biotechnology, medical devices, health insurance

### ⚡ **Energy**
- **Companies**: XOM, CVX, COP, EOG, SLB, PSX, KMI, MPC, VLO
- **Focus**: Oil & gas, renewable energy, energy services, refining

### 🏠 **Consumer Staples**
- **Companies**: PG, KO, PEP, WMT, COST, PM, MO, CL, GIS, K
- **Focus**: Food & beverage, household products, tobacco, essential retail

### 🏭 **Industrials**
- **Companies**: BA, CAT, MMM, UPS, FDX, GE, HON, LMT, RTX, UNP
- **Focus**: Aerospace, manufacturing, transportation, defense, infrastructure

### 🧱 **Materials**
- **Companies**: LIN, APD, FCX, NEM, BHP, RIO, VALE, DD, DOW, NUE
- **Focus**: Chemicals, mining, metals, construction materials, industrial gases

### 🏢 **Real Estate**
- **Companies**: PLD, AMT, CCI, EQIX, PSA, O, SPG, WELL, DLR, AVB
- **Focus**: REITs, property management, data centers, storage, commercial real estate

### 💡 **Utilities**
- **Companies**: NEE, DUK, SO, D, AEP, XEL, SRE, WEC, DTE, EIX
- **Focus**: Electric power, natural gas, water, renewable utilities

### 📡 **Communication Services**
- **Companies**: GOOGL, META, NFLX, DIS, CMCSA, T, VZ, TMUS, CHTR, PARA
- **Focus**: Internet services, social media, entertainment, telecommunications

---

## The `signals` Object

This object contains arrays for `historical`, `impact`, and `confidence` signals. Each signal object includes comprehensive metadata and source article tracking.

### `source_articles` Array

Every signal includes a `source_articles` array providing direct links to the news articles that contributed to the signal:

* **`title`** (String): The headline of the source article
* **`url`** (String): The direct URL to the source article for verification

**Example:**
```json
"source_articles": [
  {
    "title": "Microsoft Announces Groundbreaking AI Deal",
    "url": "https://news-source.com/msft-ai-deal-123"
  },
  {
    "title": "Apple Reports Strong iPhone Sales in Europe",
    "url": "https://another-source.com/apple-sales-q3"
  }
]
```

---

## Signal Types Breakdown

### 1. `historical` Signals
Identifies sectors with consistent sentiment trends over the last six days (requires 3+ consecutive days).

**Criteria:**
- **Bullish**: 3+ consecutive days with sentiment > 0.1
- **Bearish**: 3+ consecutive days with sentiment < -0.1

**Example:**
```json
"historical": [
  {
    "type": "HISTORICAL",
    "direction": "Bullish",
    "sector": "Technology",
    "source_articles": [
      {
        "title": "Apple Reports Strong iPhone Sales in Europe",
        "url": "https://another-source.com/apple-sales-q3"
      },
      {
        "title": "Microsoft Cloud Revenue Surges 25%",
        "url": "https://tech-news.com/msft-cloud-q3"
      },
      {
        "title": "NVIDIA AI Chip Demand Continues Growth",
        "url": "https://ai-news.com/nvda-demand-increase"
      }
    ]
  },
  {
    "type": "HISTORICAL",
    "direction": "Bearish",
    "sector": "Financial Services",
    "source_articles": [
      {
        "title": "Bank Earnings Decline for Third Consecutive Quarter",
        "url": "https://finance-news.com/bank-earnings-q3"
      },
      {
        "title": "Regulatory Pressure Mounts on Financial Institutions",
        "url": "https://reg-news.com/financial-pressure"
      },
      {
        "title": "Credit Card Default Rates Rise",
        "url": "https://credit-news.com/default-rates-up"
      }
    ]
  }
]
```

### 2. `impact` Signals
Identifies sectors likely to be affected by high-impact news events from today.

**Criteria:**
- **Impact Keywords**: regulation, act, tariff, subsidy, ban, approval, deal, acquisition, merger, lawsuit
- **Extreme Sentiment**: sentiment score > 0.90 (positive or negative)

**Example:**
```json
"impact": [
  {
    "type": "IMPACT",
    "sector": "Technology",
    "direction": "UP",
    "details": "High-impact news titled 'Microsoft Announces Groundbreaking AI Deal' (Sentiment: positive @ 0.98).",
    "source_articles": [
      {
        "title": "Microsoft Announces Groundbreaking AI Deal",
        "url": "https://news-source.com/msft-ai-deal-123"
      }
    ]
  },
  {
    "type": "IMPACT",
    "sector": "Healthcare",
    "direction": "DOWN",
    "details": "High-impact news titled 'FDA Rejects New Drug Application' (Sentiment: negative @ 0.95).",
    "source_articles": [
      {
        "title": "FDA Rejects New Drug Application",
        "url": "https://health-news.com/fda-rejection"
      }
    ]
  },
  {
    "type": "IMPACT",
    "sector": "Energy",
    "direction": "UP",
    "details": "High-impact news titled 'OPEC+ Announces Production Cuts' (Sentiment: positive @ 0.92).",
    "source_articles": [
      {
        "title": "OPEC+ Announces Production Cuts",
        "url": "https://energy-news.com/opec-cuts"
      }
    ]
  }
]
```

### 3. `confidence` Signals
The highest-priority signals where historical trends and today's impact events align, triggering stock-specific predictions.

**Criteria:**
- Historical bullish trend + Today's positive impact event = High-confidence bullish signal
- Includes predicted individual stock movers within the sector

**Example:**
```json
"confidence": [
  {
    "type": "CONFIDENCE",
    "direction": "BULLISH",
    "sector": "Technology",
    "predicted_stocks": [
      {
        "symbol": "MSFT",
        "reason": "Microsoft Announces Groundbreaking AI Deal",
        "url": "https://news-source.com/msft-ai-deal-123",
        "score": 0.98
      },
      {
        "symbol": "NVDA",
        "reason": "NVIDIA AI Chip Demand Continues Growth",
        "url": "https://ai-news.com/nvda-demand-increase",
        "score": 0.95
      }
    ],
    "source_articles": [
      {
        "title": "Apple Reports Strong iPhone Sales in Europe",
        "url": "https://another-source.com/apple-sales-q3"
      },
      {
        "title": "Microsoft Cloud Revenue Surges 25%",
        "url": "https://tech-news.com/msft-cloud-q3"
      },
      {
        "title": "NVIDIA AI Chip Demand Continues Growth",
        "url": "https://ai-news.com/nvda-demand-increase"
      },
      {
        "title": "Microsoft Announces Groundbreaking AI Deal",
        "url": "https://news-source.com/msft-ai-deal-123"
      }
    ]
  }
]
```

---

## Complete Example Report

```json
{
  "report_id": 42,
  "report_date": "2025-08-21",
  "generated_at_utc": "2025-08-21T02:30:00.123456",
  "run_source": "ONDEMAND",
  "executive_summary": "A consistent bullish trend was observed for the 'Technology' sector. A consistent bearish trend was observed for the 'Financial Services' sector. A high-impact event for the 'Technology' sector suggests a short-term move up. A high-impact event for the 'Healthcare' sector suggests a short-term move down. High-confidence bullish signals were found for the following sectors: Technology.",
  "signals": {
    "historical": [
      {
        "type": "HISTORICAL",
        "direction": "Bullish",
        "sector": "Technology",
        "source_articles": [
          {
            "title": "Apple Reports Strong iPhone Sales in Europe",
            "url": "https://another-source.com/apple-sales-q3"
          },
          {
            "title": "Microsoft Cloud Revenue Surges 25%",
            "url": "https://tech-news.com/msft-cloud-q3"
          },
          {
            "title": "NVIDIA AI Chip Demand Continues Growth",
            "url": "https://ai-news.com/nvda-demand-increase"
          }
        ]
      },
      {
        "type": "HISTORICAL",
        "direction": "Bearish",
        "sector": "Financial Services",
        "source_articles": [
          {
            "title": "Bank Earnings Decline for Third Consecutive Quarter",
            "url": "https://finance-news.com/bank-earnings-q3"
          },
          {
            "title": "Regulatory Pressure Mounts on Financial Institutions",
            "url": "https://reg-news.com/financial-pressure"
          },
          {
            "title": "Credit Card Default Rates Rise",
            "url": "https://credit-news.com/default-rates-up"
          }
        ]
      }
    ],
    "impact": [
      {
        "type": "IMPACT",
        "sector": "Technology",
        "direction": "UP",
        "details": "High-impact news titled 'Microsoft Announces Groundbreaking AI Deal' (Sentiment: positive @ 0.98).",
        "source_articles": [
          {
            "title": "Microsoft Announces Groundbreaking AI Deal",
            "url": "https://news-source.com/msft-ai-deal-123"
          }
        ]
      },
      {
        "type": "IMPACT",
        "sector": "Healthcare",
        "direction": "DOWN",
        "details": "High-impact news titled 'FDA Rejects New Drug Application' (Sentiment: negative @ 0.95).",
        "source_articles": [
          {
            "title": "FDA Rejects New Drug Application",
            "url": "https://health-news.com/fda-rejection"
          }
        ]
      }
    ],
    "confidence": [
      {
        "type": "CONFIDENCE",
        "direction": "BULLISH",
        "sector": "Technology",
        "predicted_stocks": [
          {
            "symbol": "MSFT",
            "reason": "Microsoft Announces Groundbreaking AI Deal",
            "url": "https://news-source.com/msft-ai-deal-123",
            "score": 0.98
          },
          {
            "symbol": "NVDA",
            "reason": "NVIDIA AI Chip Demand Continues Growth",
            "url": "https://ai-news.com/nvda-demand-increase",
            "score": 0.95
          }
        ],
        "source_articles": [
          {
            "title": "Apple Reports Strong iPhone Sales in Europe",
            "url": "https://another-source.com/apple-sales-q3"
          },
          {
            "title": "Microsoft Cloud Revenue Surges 25%",
            "url": "https://tech-news.com/msft-cloud-q3"
          },
          {
            "title": "NVIDIA AI Chip Demand Continues Growth",
            "url": "https://ai-news.com/nvda-demand-increase"
          },
          {
            "title": "Microsoft Announces Groundbreaking AI Deal",
            "url": "https://news-source.com/msft-ai-deal-123"
          }
        ]
      }
    ]
  }
}
```

---

## Signal Interpretation Guide

### 🟢 **High-Confidence Bullish Signals**
- **Historical Trend**: Consistent positive sentiment over 3+ days
- **Today's Impact**: Positive high-impact event
- **Action**: Strong buy signal for the sector and predicted stocks

### 🔴 **High-Confidence Bearish Signals**
- **Historical Trend**: Consistent negative sentiment over 3+ days
- **Today's Impact**: Negative high-impact event
- **Action**: Strong sell signal for the sector

### 🟡 **Historical Trend Signals**
- **Bullish**: Positive sentiment trend building
- **Bearish**: Negative sentiment trend building
- **Action**: Monitor for confirmation from impact events

### 🔵 **Impact Event Signals**
- **Positive**: Short-term upward pressure expected
- **Negative**: Short-term downward pressure expected
- **Action**: Short-term trading opportunities

---

## Run Source Tracking

The system now tracks whether each report was generated from an **ONDEMAND** or **SCHEDULED** run:

### 🚀 **ONDEMAND Runs**
- **Triggered by**: Manual execution of `rune_once.py`
- **Use case**: Fresh data collection, testing, manual analysis
- **Database field**: `run_source = "ONDEMAND"`
- **JSON field**: `"run_source": "ONDEMAND"`

### ⏰ **SCHEDULED Runs**
- **Triggered by**: Automated scheduler (daily at 2:30 AM UTC)
- **Use case**: Regular automated market analysis
- **Database field**: `run_source = "SCHEDULED"`
- **JSON field**: `"run_source": "SCHEDULED"`

### 📊 **Database Query Examples**
```sql
-- Get all ONDEMAND reports
SELECT * FROM daily_reports WHERE run_source = 'ONDEMAND';

-- Get all SCHEDULED reports
SELECT * FROM daily_reports WHERE run_source = 'SCHEDULED';

-- Count reports by source
SELECT run_source, COUNT(*) FROM daily_reports GROUP BY run_source;

-- Get today's reports by source
SELECT run_source, COUNT(*) 
FROM daily_reports 
WHERE report_date = CURRENT_DATE 
GROUP BY run_source;
```

### 🔍 **Check Run Sources**
Use the utility script to check run sources:
```bash
python check_run_sources.py                    # Check recent reports
python check_run_sources.py 2025-08-21        # Check specific date
```

### 📁 **File Naming Convention**
JSON reports now include time and run source in the filename:
- **ONDEMAND runs**: `report_YYYY-MM-DD_HHMMSS_ondemand.json`
- **SCHEDULED runs**: `report_YYYY-MM-DD_HHMMSS_scheduled.json`

**Examples:**
- `report_2025-08-21_143052_ondemand.json` (August 21, 2025 at 14:30:52 UTC, ONDEMAND)
- `report_2025-08-21_023000_scheduled.json` (August 21, 2025 at 02:30:00 UTC, SCHEDULED)

## Data Quality & Reliability

- **Source Tracking**: Every signal includes verifiable source articles
- **Run Source Tracking**: Every report tracks ONDEMAND vs SCHEDULED origin
- **Sentiment Analysis**: Advanced NLP with FinBERT financial sentiment model
- **Entity Recognition**: Comprehensive company and sector mapping
- **Historical Validation**: 6-day trend analysis for signal reliability
- **Impact Assessment**: Keyword and sentiment-based event classification

---

## Version History

- **v3 (Current)**: 11-sector coverage, enhanced source tracking, comprehensive examples
- **v2**: Executive summary, source articles, enhanced confidence signals
- **v1**: Basic historical, impact, and confidence signals
